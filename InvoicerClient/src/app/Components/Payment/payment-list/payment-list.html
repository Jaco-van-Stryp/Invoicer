<div class="page-header">
  <div>
    <h1 class="text-3xl font-bold m-0">Payments</h1>
    <p class="text-muted-color mt-1 mb-0">View and manage all recorded payments</p>
  </div>
  <button class="btn-gradient" (click)="openRecordPayment()">
    <i class="pi pi-plus" aria-hidden="true"></i>
    Record Payment
  </button>
</div>

<!-- Payment Cards -->
@if (loading()) {
  <div class="cards-grid">
    @for (i of [1, 2, 3, 4]; track i) {
      <div class="payment-card-skeleton" aria-hidden="true"></div>
    }
  </div>
} @else {
  <div class="cards-grid">
    @for (payment of payments(); track payment.id) {
      <div class="entity-card">
        <!-- Header: Invoice number + Amount -->
        <div class="entity-card-header">
          <span class="entity-card-number">{{ payment.invoiceNumber }}</span>
          <span class="payment-amount">{{ payment.amount | currency }}</span>
        </div>

        <!-- Client name -->
        <div class="entity-card-title">{{ payment.clientName }}</div>

        <!-- Date -->
        <div class="entity-card-dates">
          <div class="date-item">
            <span class="date-label">Date Paid</span>
            <span class="date-value">{{ payment.paidOn | date: 'MMM d, y' }}</span>
          </div>
        </div>

        <!-- Notes -->
        @if (payment.notes) {
          <div class="payment-notes">
            <i class="pi pi-comment" aria-hidden="true"></i>
            <span>{{ payment.notes }}</span>
          </div>
        }

        <!-- Actions -->
        <div class="entity-card-actions">
          <p-button
            icon="pi pi-trash"
            [rounded]="true"
            [outlined]="true"
            severity="danger"
            size="small"
            (click)="deletePayment(payment)"
            pTooltip="Delete"
            aria-label="Delete payment"
          />
        </div>
      </div>
    } @empty {
      <div class="empty-state">
        <i class="pi pi-credit-card" aria-hidden="true"></i>
        <p>No payments recorded yet. Click "Record Payment" to add one.</p>
      </div>
    }
  </div>
}

<app-payment-form-dialog
  [(visible)]="recordDialogVisible"
  [invoices]="invoices()"
  (saved)="onPaymentSaved()"
/>

<p-confirmDialog />
