<div class="page-header">
  <div>
    <h1 class="text-3xl font-bold m-0">Products</h1>
    <p class="text-muted-color mt-1 mb-0">
      {{ products().length }} product{{ products().length !== 1 ? 's' : '' }} in catalog
    </p>
  </div>
  <button class="btn-gradient" (click)="openNew()">
    <i class="pi pi-plus" aria-hidden="true"></i>
    New Product
  </button>
</div>

<!-- Search Bar -->
<div class="search-bar">
  <p-iconfield>
    <p-inputicon styleClass="pi pi-search" />
    <input
      pInputText
      type="text"
      placeholder="Search products..."
      [ngModel]="searchQuery()"
      (ngModelChange)="searchQuery.set($event)"
      aria-label="Search products"
      class="w-full"
    />
  </p-iconfield>
</div>

<!-- Loading State -->
@if (loading()) {
  <div class="products-grid">
    @for (i of [1, 2, 3, 4, 5, 6]; track i) {
      <div class="product-card-skeleton" aria-hidden="true"></div>
    }
  </div>
} @else {
  <!-- Product Cards -->
  <div class="products-grid">
    @for (product of filteredProducts(); track product.id) {
      <div class="product-card">
        <!-- Product image or placeholder -->
        <div class="product-image-area">
          @if (product.imageUrl) {
            <img
              [src]="product.imageUrl"
              [alt]="product.name || 'Product image'"
              class="product-image"
            />
          } @else {
            <div class="product-image-placeholder" aria-hidden="true">
              <i class="pi pi-box"></i>
            </div>
          }
        </div>

        <div class="product-body">
          <h3 class="product-name">{{ product.name }}</h3>
          @if (product.description) {
            <p class="product-description">{{ product.description }}</p>
          }
          <div class="product-price">{{ product.price | currency }}</div>
        </div>

        <div class="product-card-actions">
          <p-button
            label="Edit"
            icon="pi pi-pencil"
            [text]="true"
            size="small"
            (click)="editProduct(product)"
            pTooltip="Edit product"
            aria-label="Edit product"
          />
          <p-button
            label="Delete"
            icon="pi pi-trash"
            [text]="true"
            severity="danger"
            size="small"
            (click)="deleteProduct(product)"
            pTooltip="Delete product"
            aria-label="Delete product"
          />
        </div>
      </div>
    } @empty {
      <div class="empty-state">
        <i class="pi pi-box" aria-hidden="true"></i>
        @if (searchQuery()) {
          <p>No products match "{{ searchQuery() }}".</p>
        } @else {
          <p>No products yet. Click "New Product" to add one.</p>
        }
      </div>
    }
  </div>
}

<app-product-form-dialog
  [(visible)]="dialogVisible"
  [product]="selectedProduct()"
  (saved)="onSaved()"
/>

<p-confirmDialog />
