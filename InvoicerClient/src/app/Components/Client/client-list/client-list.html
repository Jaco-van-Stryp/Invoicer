<div class="page-header">
  <div>
    <h1 class="text-3xl font-bold m-0">Clients</h1>
    <p class="text-muted-color mt-1 mb-0">
      {{ clients().length }} client{{ clients().length !== 1 ? 's' : '' }} total
    </p>
  </div>
  <button class="btn-gradient" (click)="openNew()">
    <i class="pi pi-plus" aria-hidden="true"></i>
    New Client
  </button>
</div>

<!-- Search Bar -->
<div class="search-bar">
  <p-iconfield>
    <p-inputicon styleClass="pi pi-search" />
    <input
      pInputText
      type="text"
      placeholder="Search by name, email or phone..."
      [ngModel]="searchQuery()"
      (ngModelChange)="searchQuery.set($event)"
      aria-label="Search clients"
      class="w-full"
    />
  </p-iconfield>
</div>

<!-- Loading State -->
@if (loading()) {
  <div class="loading-grid">
    @for (i of [1, 2, 3, 4, 5, 6]; track i) {
      <div class="client-card-skeleton" aria-hidden="true"></div>
    }
  </div>
} @else {
  <!-- Client Cards -->
  <div class="clients-grid">
    @for (client of filteredClients(); track client.id) {
      <div class="client-card">
        <div class="client-card-header">
          <div class="client-avatar" aria-hidden="true">
            {{ getInitials(client.name) }}
          </div>
          <div class="client-identity">
            <h3 class="client-name">{{ client.name }}</h3>
            @if (client.email) {
              <a [href]="'mailto:' + client.email" class="client-email">
                {{ client.email }}
              </a>
            }
          </div>
        </div>

        <div class="client-details">
          @if (client.phoneNumber) {
            <div class="client-detail">
              <i class="pi pi-phone" aria-hidden="true"></i>
              <span>{{ client.phoneNumber }}</span>
            </div>
          }
          @if (client.address) {
            <div class="client-detail">
              <i class="pi pi-map-marker" aria-hidden="true"></i>
              <span>{{ client.address }}</span>
            </div>
          }
          @if (client.taxNumber) {
            <div class="client-detail">
              <i class="pi pi-hashtag" aria-hidden="true"></i>
              <span>{{ client.taxNumber }}</span>
            </div>
          }
        </div>

        <div class="client-card-actions">
          <p-button
            label="Edit"
            icon="pi pi-pencil"
            [text]="true"
            size="small"
            (click)="editClient(client)"
            pTooltip="Edit client"
            aria-label="Edit client"
          />
          <p-button
            label="Delete"
            icon="pi pi-trash"
            [text]="true"
            severity="danger"
            size="small"
            (click)="deleteClient(client)"
            pTooltip="Delete client"
            aria-label="Delete client"
          />
        </div>
      </div>
    } @empty {
      <div class="empty-state">
        <i class="pi pi-users" aria-hidden="true"></i>
        @if (searchQuery()) {
          <p>No clients match "{{ searchQuery() }}".</p>
        } @else {
          <p>No clients yet. Click "New Client" to add your first one.</p>
        }
      </div>
    }
  </div>
}

<app-client-form-dialog
  [(visible)]="dialogVisible"
  [client]="selectedClient()"
  (saved)="onSaved()"
/>

<p-confirmDialog />
