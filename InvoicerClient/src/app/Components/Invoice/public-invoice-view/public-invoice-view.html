@if (loading()) {
  <div class="loading-state">
    <div class="loading-spinner" aria-hidden="true"></div>
    <p>Loading invoice...</p>
  </div>
} @else if (error()) {
  <div class="error-state" role="alert">
    <i class="pi pi-exclamation-circle" aria-hidden="true"></i>
    <h2>{{ error() }}</h2>
    <p>The invoice you're looking for could not be found or has been removed.</p>
  </div>
} @else if (invoice()) {
  <div class="invoice-page">
    <!-- Toolbar (hidden on print) -->
    <div class="invoice-toolbar no-print" role="banner">
      <span class="toolbar-brand gradient-text">Invoicer</span>
      <p-button
        label="Print / Save PDF"
        icon="pi pi-print"
        (click)="print()"
        aria-label="Print or save invoice as PDF"
      />
    </div>

    <!-- Invoice document -->
    <main class="invoice-wrapper">
      <div class="invoice-document">
        <!-- Gradient accent bar -->
        <div class="accent-bar" aria-hidden="true"></div>

        <!-- Header: company branding + invoice meta -->
        <div class="invoice-header">
          <div class="company-section">
            @if (invoice()?.company?.logoUrl) {
              <img
                [src]="invoice()?.company?.logoUrl ?? ''"
                alt="{{ invoice()?.company?.name }} logo"
                class="company-logo"
              />
            }
            <div class="company-name">{{ invoice()?.company?.name }}</div>
            <div class="company-details" aria-label="Company contact details">
              @if (invoice()?.company?.address) {
                <div class="company-detail-row">
                  <i class="pi pi-map-marker" aria-hidden="true"></i>
                  <span>{{ invoice()?.company?.address }}</span>
                </div>
              }
              @if (invoice()?.company?.email) {
                <div class="company-detail-row">
                  <i class="pi pi-envelope" aria-hidden="true"></i>
                  <span>{{ invoice()?.company?.email }}</span>
                </div>
              }
              @if (invoice()?.company?.phone) {
                <div class="company-detail-row">
                  <i class="pi pi-phone" aria-hidden="true"></i>
                  <span>{{ invoice()?.company?.phone }}</span>
                </div>
              }
            </div>
          </div>

          <div class="invoice-meta" aria-label="Invoice details">
            <div class="invoice-label" aria-hidden="true">INVOICE</div>
            <div
              class="status-badge status-{{ invoice()?.status?.toLowerCase() }}"
              role="status"
              [attr.aria-label]="'Status: ' + invoice()?.status"
            >
              {{ invoice()?.status }}
            </div>
            <dl class="meta-list">
              <dt>Invoice #</dt>
              <dd>{{ invoice()?.invoiceNumber }}</dd>
              <dt>Date</dt>
              <dd>{{ invoice()?.invoiceDate | date: 'mediumDate' }}</dd>
              <dt>Due Date</dt>
              <dd>{{ invoice()?.dueDate | date: 'mediumDate' }}</dd>
            </dl>
          </div>
        </div>

        <!-- Bill To -->
        <section class="bill-to-section" aria-label="Billing information">
          <div class="section-label">Bill To</div>
          <div class="client-name">{{ invoice()?.client?.name }}</div>
          @if (invoice()?.client?.email) {
            <div class="client-detail">{{ invoice()?.client?.email }}</div>
          }
          @if (invoice()?.client?.phone) {
            <div class="client-detail">{{ invoice()?.client?.phone }}</div>
          }
          @if (invoice()?.client?.address) {
            <div class="client-detail">{{ invoice()?.client?.address }}</div>
          }
        </section>

        <!-- Products table -->
        <section aria-label="Invoice items">
          <table class="invoice-table">
            <thead>
              <tr>
                <th scope="col">Product</th>
                <th scope="col" class="col-center">Qty</th>
                <th scope="col" class="col-right">Unit Price</th>
                <th scope="col" class="col-right">Total</th>
              </tr>
            </thead>
            <tbody>
              @for (product of invoice()?.products ?? []; track product.name) {
                <tr>
                  <td>{{ product.name }}</td>
                  <td class="col-center">{{ product.quantity }}</td>
                  <td class="col-right">{{ product.unitPrice | currency }}</td>
                  <td class="col-right">{{ product.totalPrice | currency }}</td>
                </tr>
              }
            </tbody>
          </table>
        </section>

        <!-- Totals -->
        <div class="totals-section" aria-label="Invoice totals">
          <div class="totals-row">
            <span class="totals-label">Subtotal</span>
            <span class="totals-value">{{ subtotal() | currency }}</span>
          </div>
          <div class="totals-divider" aria-hidden="true"></div>
          <div class="totals-row">
            <span class="totals-label grand-total-label">Total</span>
            <span class="totals-value grand-total-value">{{ total() | currency }}</span>
          </div>
        </div>

        <!-- Notes -->
        @if (invoice()?.notes) {
          <section class="notes-section" aria-label="Invoice notes">
            <div class="section-label">Notes</div>
            <p class="notes-text">{{ invoice()!.notes }}</p>
          </section>
        }

        <!-- Footer -->
        <footer class="invoice-footer">
          <div class="footer-message">Thank you for your business!</div>
          <div class="footer-brand no-print">
            Powered by <span class="gradient-text">Invoicer</span>
          </div>
        </footer>
      </div>
    </main>
  </div>
}
