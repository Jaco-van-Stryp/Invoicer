@if (loading()) {
  <div class="loading-container">
    <i class="pi pi-spin pi-spinner" style="font-size: 2rem"></i>
    <p>Loading invoice...</p>
  </div>
} @else if (error()) {
  <div class="error-container">
    <i class="pi pi-exclamation-circle" style="font-size: 3rem; color: var(--red-500)"></i>
    <h2>{{ error() }}</h2>
    <p>The invoice you're looking for could not be found or has been removed.</p>
  </div>
} @else if (invoice()) {
  <div class="invoice-container">
    <div class="print-actions no-print">
      <button pButton icon="pi pi-print" label="Print Invoice" (click)="print()"></button>
    </div>

    <div class="invoice-document">
      <div class="invoice-header">
        <div class="company-info">
          @if (invoice()?.company?.logoUrl) {
            <img
              [src]="invoice()?.company?.logoUrl ?? ''"
              alt="Company Logo"
              class="company-logo"
            />
          }
          <h1>{{ invoice()?.company?.name }}</h1>
          <p>{{ invoice()?.company?.address }}</p>
          <p>{{ invoice()?.company?.email }}</p>
          <p>{{ invoice()?.company?.phone }}</p>
        </div>
        <div class="invoice-meta">
          <h2>INVOICE</h2>
          <p><strong>Invoice #:</strong> {{ invoice()?.invoiceNumber }}</p>
          <p><strong>Date:</strong> {{ invoice()?.invoiceDate | date: 'mediumDate' }}</p>
          <p><strong>Due Date:</strong> {{ invoice()?.dueDate | date: 'mediumDate' }}</p>
          <p>
            <strong>Status:</strong>
            <span class="status-badge status-{{ invoice()?.status?.toLowerCase() }}">{{
              invoice()?.status
            }}</span>
          </p>
        </div>
      </div>

      <div class="invoice-client">
        <h3>Bill To:</h3>
        <p class="client-name">{{ invoice()?.client?.name }}</p>
        @if (invoice()?.client?.address) {
          <p>{{ invoice()?.client?.address }}</p>
        }
        @if (invoice()?.client?.email) {
          <p>{{ invoice()?.client?.email }}</p>
        }
        @if (invoice()?.client?.phone) {
          <p>{{ invoice()?.client?.phone }}</p>
        }
      </div>

      <table class="invoice-items">
        <thead>
          <tr>
            <th>Product</th>
            <th class="text-center">Quantity</th>
            <th class="text-right">Unit Price</th>
            <th class="text-right">Total</th>
          </tr>
        </thead>
        <tbody>
          @for (product of invoice()?.products ?? []; track product.name) {
            <tr>
              <td>{{ product.name }}</td>
              <td class="text-center">{{ product.quantity }}</td>
              <td class="text-right">{{ product.unitPrice | currency }}</td>
              <td class="text-right">{{ product.totalPrice | currency }}</td>
            </tr>
          }
        </tbody>
        <tfoot>
          <tr class="subtotal-row">
            <td colspan="3" class="text-right"><strong>Subtotal:</strong></td>
            <td class="text-right">{{ subtotal | currency }}</td>
          </tr>
          <tr class="total-row">
            <td colspan="3" class="text-right"><strong>Total:</strong></td>
            <td class="text-right">{{ total | currency }}</td>
          </tr>
        </tfoot>
      </table>

      @if (invoice()?.notes) {
        <div class="invoice-notes">
          <h3>Notes:</h3>
          <p>{{ invoice()!.notes }}</p>
        </div>
      }

      <div class="invoice-footer">
        <p>Thank you for your business!</p>
      </div>
    </div>
  </div>
}
